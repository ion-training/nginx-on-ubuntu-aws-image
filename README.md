# AWS AMI: nginx on ubuntu using packer

# Description
Create an nginx web server on ubuntu image to deploy static pages.\
The image is build on AWS by default in "eu-central-1" region.
This image contains a default instalation of nginx. If you need to change the nginx confiration please refer to [nginx docs](http://nginx.org/en/docs/)

# How to use

If you don't have AWS credentials you can create them on [this page](https://console.aws.amazon.com/iam/home?#security_credential).

Add your AWS credentials as two environment variables:
```
export AWS_ACCESS_KEY_ID=<YOUR_ACCESS_KEY>
export AWS_SECRET_ACCESS_KEY=<YOUR_SECRET_KEY>
```

Clone the repository on your computer
```bash
git clone git@github.com:ionhashicorp/nginx-on-ubuntu-aws-image.git
```

drive into the directory named nginx-on-ubuntu-aws-image
```bash
cd nginx-on-ubuntu-aws-image
```

build the image with the following command:
```
packer build nginx-on-ubuntu.pkr.hcl
```

AMI image located at:
[AWS AMI management page](https://us-west-2.console.aws.amazon.com/ec2/v2/home?region=eu-central-1#Images:visibility=owned-by-me;search=learn-packer-linux-aws;sort=tag:Name)

# Change the region of the AMI
You can specify a different region where you want to deploy the image by specifying the [region](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html) code:

```
packer build --var region=<REGION_CODE> nginx-on-ubuntu.pkr.hcl
```


# Sample output
```
$ packer build nginx-on-ubuntu.pkr.hcl
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Prevalidating any provided VPC information
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Prevalidating AMI Name: nginx-on-ubuntu-aws-20210916113241
    nginx-on-ubuntu.amazon-ebs.ubuntu: Found Image ID: ami-01299931803ce83f6
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Creating temporary keypair: packer_61432b59-301d-d543-e0aa-d4a7b9ad17eb
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Creating temporary security group for this instance: packer_61432b5a-eef6-077d-f256-e89bbf87e35c
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Authorizing access to port 22 from [0.0.0.0/0] in the temporary security groups...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Launching a source AWS instance...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Adding tags to source instance
    nginx-on-ubuntu.amazon-ebs.ubuntu: Adding tag: "Name": "Packer Builder"
    nginx-on-ubuntu.amazon-ebs.ubuntu: Instance ID: i-057b4d758d61d4235
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Waiting for instance (i-057b4d758d61d4235) to become ready...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Using SSH communicator to connect: 18.184.126.62
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Waiting for SSH to become available...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Connected to SSH!
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Provisioning with shell script: /var/folders/k2/jxw8lbzx3k91ml2q8w02zfv00000gq/T/packer-shell700983776
    nginx-on-ubuntu.amazon-ebs.ubuntu: Hit:1 http://archive.ubuntu.com/ubuntu xenial InRelease
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:2 http://archive.ubuntu.com/ubuntu xenial-updates InRelease [109 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:3 http://archive.ubuntu.com/ubuntu xenial-backports InRelease [107 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:4 http://security.ubuntu.com/ubuntu xenial-security InRelease [109 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:5 http://archive.ubuntu.com/ubuntu xenial/universe amd64 Packages [7532 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:6 https://esm.ubuntu.com/infra/ubuntu xenial-infra-security InRelease [7506 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:7 https://esm.ubuntu.com/infra/ubuntu xenial-infra-updates InRelease [7475 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:8 http://archive.ubuntu.com/ubuntu xenial/universe Translation-en [4354 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:9 http://archive.ubuntu.com/ubuntu xenial/multiverse amd64 Packages [144 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:10 http://archive.ubuntu.com/ubuntu xenial/multiverse Translation-en [106 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:11 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 Packages [2049 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:12 http://archive.ubuntu.com/ubuntu xenial-updates/main Translation-en [482 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:13 http://archive.ubuntu.com/ubuntu xenial-updates/universe amd64 Packages [1219 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:14 http://archive.ubuntu.com/ubuntu xenial-updates/universe Translation-en [358 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:15 http://archive.ubuntu.com/ubuntu xenial-updates/multiverse amd64 Packages [22.6 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:16 http://archive.ubuntu.com/ubuntu xenial-updates/multiverse Translation-en [8476 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:17 http://archive.ubuntu.com/ubuntu xenial-backports/main amd64 Packages [9812 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:18 http://archive.ubuntu.com/ubuntu xenial-backports/main Translation-en [4456 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:19 http://archive.ubuntu.com/ubuntu xenial-backports/universe amd64 Packages [11.3 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:20 http://archive.ubuntu.com/ubuntu xenial-backports/universe Translation-en [4476 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:21 http://security.ubuntu.com/ubuntu xenial-security/main amd64 Packages [1648 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:22 http://security.ubuntu.com/ubuntu xenial-security/universe amd64 Packages [785 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:23 https://esm.ubuntu.com/infra/ubuntu xenial-infra-security/main amd64 Packages [171 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:24 http://security.ubuntu.com/ubuntu xenial-security/universe Translation-en [225 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:25 http://security.ubuntu.com/ubuntu xenial-security/multiverse amd64 Packages [7864 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:26 http://security.ubuntu.com/ubuntu xenial-security/multiverse Translation-en [2672 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Fetched 19.5 MB in 8s (2272 kB/s)
    nginx-on-ubuntu.amazon-ebs.ubuntu: Reading package lists...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Reading package lists...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Building dependency tree...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Reading state information...
    nginx-on-ubuntu.amazon-ebs.ubuntu: The following additional packages will be installed:
    nginx-on-ubuntu.amazon-ebs.ubuntu:   fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
    nginx-on-ubuntu.amazon-ebs.ubuntu:   libjpeg-turbo8 libjpeg8 libtiff5 libvpx3 libxpm4 nginx-common nginx-core
    nginx-on-ubuntu.amazon-ebs.ubuntu: Suggested packages:
    nginx-on-ubuntu.amazon-ebs.ubuntu:   libgd-tools fcgiwrap nginx-doc ssl-cert
    nginx-on-ubuntu.amazon-ebs.ubuntu: The following NEW packages will be installed:
    nginx-on-ubuntu.amazon-ebs.ubuntu:   fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
    nginx-on-ubuntu.amazon-ebs.ubuntu:   libjpeg-turbo8 libjpeg8 libtiff5 libvpx3 libxpm4 nginx nginx-common
    nginx-on-ubuntu.amazon-ebs.ubuntu:   nginx-core
    nginx-on-ubuntu.amazon-ebs.ubuntu: 0 upgraded, 13 newly installed, 0 to remove and 4 not upgraded.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Need to get 2860 kB of archives.
    nginx-on-ubuntu.amazon-ebs.ubuntu: After this operation, 9315 kB of additional disk space will be used.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:1 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libjpeg-turbo8 amd64 1.4.2-0ubuntu3.4 [111 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:2 http://archive.ubuntu.com/ubuntu xenial/main amd64 libjbig0 amd64 2.1-3.1 [26.6 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:3 http://archive.ubuntu.com/ubuntu xenial/main amd64 fonts-dejavu-core all 2.35-1 [1039 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:4 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 fontconfig-config all 2.11.94-0ubuntu1.1 [49.9 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:5 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libfontconfig1 amd64 2.11.94-0ubuntu1.1 [131 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:6 http://archive.ubuntu.com/ubuntu xenial/main amd64 libjpeg8 amd64 8c-2ubuntu8 [2194 B]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:7 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libtiff5 amd64 4.0.6-1ubuntu0.8 [149 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:8 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libvpx3 amd64 1.5.0-2ubuntu1.1 [732 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:9 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libxpm4 amd64 1:3.5.11-1ubuntu0.16.04.1 [33.8 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:10 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libgd3 amd64 2.1.1-4ubuntu0.16.04.12 [126 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:11 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 nginx-common all 1.10.3-0ubuntu0.16.04.5 [26.9 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:12 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 nginx-core amd64 1.10.3-0ubuntu0.16.04.5 [429 kB]
    nginx-on-ubuntu.amazon-ebs.ubuntu: Get:13 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 nginx all 1.10.3-0ubuntu0.16.04.5 [3494 B]
==> nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: unable to initialize frontend: Dialog
==> nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
==> nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: falling back to frontend: Readline
==> nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: unable to initialize frontend: Readline
==> nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: (This frontend requires a controlling tty.)
==> nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: falling back to frontend: Teletype
==> nginx-on-ubuntu.amazon-ebs.ubuntu: dpkg-preconfigure: unable to re-open stdin:
    nginx-on-ubuntu.amazon-ebs.ubuntu: Fetched 2860 kB in 0s (12.5 MB/s)
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package libjpeg-turbo8:amd64.
    nginx-on-ubuntu.amazon-ebs.ubuntu: (Reading database ... 51558 files and directories currently installed.)
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../libjpeg-turbo8_1.4.2-0ubuntu3.4_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking libjpeg-turbo8:amd64 (1.4.2-0ubuntu3.4) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package libjbig0:amd64.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../libjbig0_2.1-3.1_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking libjbig0:amd64 (2.1-3.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package fonts-dejavu-core.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../fonts-dejavu-core_2.35-1_all.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking fonts-dejavu-core (2.35-1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package fontconfig-config.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../fontconfig-config_2.11.94-0ubuntu1.1_all.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking fontconfig-config (2.11.94-0ubuntu1.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package libfontconfig1:amd64.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../libfontconfig1_2.11.94-0ubuntu1.1_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking libfontconfig1:amd64 (2.11.94-0ubuntu1.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package libjpeg8:amd64.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../libjpeg8_8c-2ubuntu8_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking libjpeg8:amd64 (8c-2ubuntu8) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package libtiff5:amd64.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../libtiff5_4.0.6-1ubuntu0.8_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking libtiff5:amd64 (4.0.6-1ubuntu0.8) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package libvpx3:amd64.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../libvpx3_1.5.0-2ubuntu1.1_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking libvpx3:amd64 (1.5.0-2ubuntu1.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package libxpm4:amd64.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../libxpm4_1%3a3.5.11-1ubuntu0.16.04.1_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking libxpm4:amd64 (1:3.5.11-1ubuntu0.16.04.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package libgd3:amd64.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../libgd3_2.1.1-4ubuntu0.16.04.12_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking libgd3:amd64 (2.1.1-4ubuntu0.16.04.12) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package nginx-common.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../nginx-common_1.10.3-0ubuntu0.16.04.5_all.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking nginx-common (1.10.3-0ubuntu0.16.04.5) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package nginx-core.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../nginx-core_1.10.3-0ubuntu0.16.04.5_amd64.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking nginx-core (1.10.3-0ubuntu0.16.04.5) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Selecting previously unselected package nginx.
    nginx-on-ubuntu.amazon-ebs.ubuntu: Preparing to unpack .../nginx_1.10.3-0ubuntu0.16.04.5_all.deb ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Unpacking nginx (1.10.3-0ubuntu0.16.04.5) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for libc-bin (2.23-0ubuntu11.3) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for man-db (2.7.5-1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for ureadahead (0.100.0-19.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for systemd (229-4ubuntu21.31) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for ufw (0.35-0ubuntu2) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up libjpeg-turbo8:amd64 (1.4.2-0ubuntu3.4) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up libjbig0:amd64 (2.1-3.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up fonts-dejavu-core (2.35-1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up fontconfig-config (2.11.94-0ubuntu1.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up libfontconfig1:amd64 (2.11.94-0ubuntu1.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up libjpeg8:amd64 (8c-2ubuntu8) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up libtiff5:amd64 (4.0.6-1ubuntu0.8) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up libvpx3:amd64 (1.5.0-2ubuntu1.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up libxpm4:amd64 (1:3.5.11-1ubuntu0.16.04.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up libgd3:amd64 (2.1.1-4ubuntu0.16.04.12) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up nginx-common (1.10.3-0ubuntu0.16.04.5) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: unable to initialize frontend: Dialog
    nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
    nginx-on-ubuntu.amazon-ebs.ubuntu: debconf: falling back to frontend: Readline
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up nginx-core (1.10.3-0ubuntu0.16.04.5) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Setting up nginx (1.10.3-0ubuntu0.16.04.5) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for libc-bin (2.23-0ubuntu11.3) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for ureadahead (0.100.0-19.1) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for systemd (229-4ubuntu21.31) ...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Processing triggers for ufw (0.35-0ubuntu2) ...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Stopping the source instance...
    nginx-on-ubuntu.amazon-ebs.ubuntu: Stopping instance
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Waiting for the instance to stop...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Creating AMI nginx-on-ubuntu-aws-20210916113241 from instance i-057b4d758d61d4235
    nginx-on-ubuntu.amazon-ebs.ubuntu: AMI: ami-0a361d2853a3b2a86
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Waiting for AMI to become ready...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Skipping Enable AMI deprecation...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Terminating the source AWS instance...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Cleaning up any extra volumes...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: No volumes to clean up, skipping
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Deleting temporary security group...
==> nginx-on-ubuntu.amazon-ebs.ubuntu: Deleting temporary keypair...
Build 'nginx-on-ubuntu.amazon-ebs.ubuntu' finished after 3 minutes 23 seconds.

==> Wait completed after 3 minutes 23 seconds

==> Builds finished. The artifacts of successful builds are:
--> nginx-on-ubuntu.amazon-ebs.ubuntu: AMIs were created:
eu-central-1: ami-0a361d2853a3b2a86
```
